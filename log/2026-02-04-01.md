# Claribot v0.2 아키텍처 토론 (2026-02-04)

## 핵심 개념

**Claribot = 장기 주행 컨텍스트 오케스트레이터**
- Claude Code 단독: 컨텍스트 창 안에서 해결 가능한 작업
- Claribot: 컨텍스트 창을 넘어서는 거대 작업(5-6시간급)의 분할 정복

## 기본 구조

1. 사용자가 Message를 입력
2. claribot이 TTY 핸드오버 Claude Code에게 실행 없이 Task만 등록 지시
3. Claude Code가 Task 등록 완료 후 보고서 파일 생성
4. claribot이 보고서 감지 → Claude Code kill
5. 생성된 Task들을 순서대로 TTY 핸드오버 Claude Code에게 실행
6. Task 수행 중 하위 Task 등록 가능
7. 모든 Task 완료 → 최종 보고서 → 사용자 피드백

## 핵심 기술: Task 컨텍스트 선별 주입

- Task와 Edge가 있는 Task에 대한 정보만 선별적으로 취합
- 시스템 프롬프트로 컨텍스트 주입
- 전체 히스토리 덤프가 아닌 **그래프 기반 선별 주입**

| 접근법 | 컨텍스트 사용량 |
|--------|----------------|
| 전체 히스토리 | O(n) - 모든 Task 누적 |
| 선별 주입 | O(k) - 연결된 Task만 |

## 2회 순회 모델

### 1회차: 작업지시서 기반 생성
- 모든 Task가 Edge로 연결된 Task의 **작업지시서만** 보고 실행
- 결과물 없이 작업
- 병렬 실행 가능

### 2회차: 결과물 기반 일관성 검토
- 모든 Task가 Edge로 연결된 Task의 **결과물**을 보고 검토
- 일관성 불일치 수정

## Task 분할 전략 (플랫폼 개발)

### 매트릭스 구조: Phase × Feature × App

```
                  │ 회원 │ 블로그 │ 결재 │ 알림 │
──────────────────┼──────┼────────┼──────┼──────┤
기획 (공통)       │  A1  │   A2   │  A3  │  A4  │
DB (공통)         │  B1  │   B2   │  B3  │  B4  │
──────────────────┼──────┼────────┼──────┼──────┤ ← Admin App
관리 백엔드       │  C1  │   C2   │  C3  │  C4  │
관리 프론트엔드   │  D1  │   D2   │  D3  │  D4  │
──────────────────┼──────┼────────┼──────┼──────┤ ← Public App
공개 백엔드       │  E1  │   E2   │  E3  │  E4  │
공개 프론트엔드   │  F1  │   F2   │  F3  │  F4  │
```

### 계층 구조

- **Level 0**: 매트릭스 정의 (Phase × Feature)
- **Level 1**: 셀 = Task (A1, B1, C1, ...)
- **Level 2**: 셀 내 하위 Task
  - 기획: 화면 단위
  - DB: 테이블 단위
  - BE: REST 엔드포인트 단위
  - FE: 라우트 URI 단위

### Edge 흐름

```
        기획(A2)
           ↓
         DB(B2)
        ↙    ↘
    C2(관리BE)  E2(공개BE)
       ↓          ↓
    D2(관리FE)  F2(공개FE)
```

- 수직: Phase 순서 (기획→DB→BE→FE)
- 수평: Feature 간 의존성 (Claude 판단)

## 전략 파일 구조

```
~/.claribot/strategies/
├── dev.platform.md      # 플랫폼 개발
├── dev.cli.md           # CLI 도구 개발
├── refactor.module.md   # 모듈 리팩토링
├── fix.bug.md           # 버그 수정
└── docs.api.md          # API 문서화
```

Claude Code가 전략 파일을 시스템 프롬프트로 받아 Task 분할 수행.

## 스케일 고려사항

- Phase × Feature 매트릭스로 셀 단위 분할
- 셀 내부 Edge 연결: Claude 1회 실행으로 처리 가능
- 셀 간 Edge: 규칙 기반 자동 생성
- Feature 10개 × Phase 6개 = 60셀 → 관리 가능

## v0.1 vs v0.2

| | v0.1 | v0.2 |
|--|------|------|
| 명세서 규모 | 11,302 라인 | 최소화 목표 |
| 컴포넌트 | 6개 (BOT, CLI, DB, FDL, TTY, VSCode) | 2개 (claribot, clari CLI) |
| 핵심 개념 | Feature, Task, Edge, Expert, Plan, FDL... | Message, Task, Edge |

## 다음 단계

1. dev.platform.md 전략 파일 상세 정의
2. Claribot 코어 최소 구현
3. 실제 플랫폼 프로젝트로 검증
