# Claribot 모바일 앱

> **상태**: 기획 중

---

## 1. 개요

### 1.1 목적

텔레그램 봇에 의존하지 않고 Claribot 서비스에 직접 접근하는 네이티브 모바일 클라이언트. 텔레그램 봇이 간편한 빠른 접근 인터페이스로 기능하는 반면, 모바일 앱은 이동 중에도 프로젝트, 태스크, Claude Code 상호작용을 관리할 수 있는 더 풍부한 전용 경험을 제공한다.

### 1.2 기존 인터페이스와의 관계

```
┌──────────────────────────────────────────────────────────┐
│                     claribot (daemon)                     │
│                                                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ Telegram │  │   CLI    │  │  Web UI  │  │   TTY    │ │
│  │ Handler  │  │ Handler  │  │ Handler  │  │ Manager  │ │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘ │
│       │             │             │              │        │
│       └─────────────┼─────────────┼──────────────┘        │
│                     ▼             │                        │
│              ┌──────────┐   ┌────▼─────┐                  │
│              │    DB    │   │ RESTful  │                   │
│              │ (SQLite) │   │   API    │                   │
│              └──────────┘   │ + Auth   │                   │
│                             └──────────┘                  │
└──────────────────────────────────────────────────────────┘
       ▲              ▲              ▲              ▲
       │ 메시지        │ HTTP         │ HTTP          │ HTTP
  [Telegram]     [clari CLI]     [Web UI]     [모바일 앱]
```

| 인터페이스 | 장점 | 한계 |
|-----------|------|------|
| **텔레그램** | 항상 접근 가능, 빠른 명령, 그룹 공유 가능 | 제한된 UI, 트리 뷰 없음, 대시보드 없음 |
| **CLI** | 스크립트 가능, 개발자 친화적, 빠름 | 터미널 전용, 시각적 피드백 없음 |
| **Web UI** | 풍부한 시각적 대시보드, 다양한 인터랙션 | 브라우저 필요, 푸시 알림 없음 |
| **모바일 앱** | 네이티브 푸시 알림, 오프라인 접근, 터치 최적화, 항상 휴대 | 별도 설치 필요 |

### 1.3 모바일 앱의 핵심 차별점

- **푸시 알림**: 태스크 완료, 순회 진행, 오류 발생 시 실시간 알림
- **오프라인 접근**: 네트워크 없이도 캐시된 프로젝트/태스크 데이터 조회 가능
- **네이티브 경험**: 부드러운 애니메이션, 제스처 네비게이션, 시스템 수준 통합
- **즉시 접근**: 브라우저를 열지 않고 홈 화면에서 바로 접근

---

## 2. 기술 스택

### 2.1 프레임워크 비교

| 기준 | React Native | Flutter | Go Mobile |
|------|-------------|---------|-----------|
| **Web UI 코드 재사용** | 높음 (React + TS) | 낮음 (Dart) | 없음 |
| **생태계** | 성숙, 대규모 | 성장 중, Google 지원 | 최소 |
| **성능** | 좋음 (JSI/Fabric) | 우수 (Skia) | 네이티브 수준 |
| **개발 속도** | 빠름 (Hot Reload) | 빠름 (Hot Reload) | 느림 |
| **팀 친숙도** | 높음 (기존 React/TS 스택) | 낮음 | 보통 (Go 백엔드) |

### 2.2 권장: React Native

**React Native**를 다음 이유로 권장한다:

1. **최대 코드 재사용**: 기존 Web UI가 React + TypeScript로 구축되어 있어 다음을 직접 공유 가능:
   - `types/index.ts` - 모든 TypeScript 타입 정의
   - `api/client.ts` - API 클라이언트 함수 (URL 설정만 변경)
   - `hooks/useClaribot.ts` - TanStack Query 훅 (동일한 캐싱/무효화 로직)
   - `hooks/useAuth.ts` - 인증 훅
   - 비즈니스 로직 및 상태 관리 패턴

2. **공유 의존성**: TanStack Query, React Router (React Navigation 매핑), react-markdown

3. **개발자 경험**: 동일 언어 (TypeScript), 동일 패러다임 (React 컴포넌트), 동일 도구 (npm/yarn)

### 2.3 기술 스택

| 카테고리 | 선택 | 이유 |
|---------|------|------|
| **프레임워크** | React Native + TypeScript | Web UI와 코드 재사용 |
| **네비게이션** | React Navigation v7 | 표준 RN 네비게이션, React Router 개념 매핑 |
| **UI 라이브러리** | React Native Paper 또는 Tamagui | Material Design / 크로스 플랫폼 스타일링 |
| **상태 관리** | TanStack Query | Web UI와 동일, 서버 상태 캐싱 |
| **푸시 알림** | Firebase Cloud Messaging (FCM) | 크로스 플랫폼 푸시 지원 |
| **오프라인 저장소** | MMKV 또는 AsyncStorage | 오프라인 데이터용 빠른 키-값 캐시 |
| **마크다운** | react-native-markdown-display | Spec/Plan/Report 렌더링 |
| **QR 코드** | react-native-qrcode-svg | TOTP 설정 QR 생성 |
| **보안 저장소** | react-native-keychain | JWT 토큰 보안 저장 |

### 2.4 서버 통신

```
┌──────────────┐         ┌──────────────┐
│   모바일 앱   │  HTTP   │   Claribot   │
│              │────────▶│   서버       │
│  TanStack    │  JSON   │  :9847/api/* │
│  Query       │◀────────│              │
│              │         │              │
│  FCM Token   │  Push   │  Push Agent  │
│  ──────────▶ │◀────────│  (향후)      │
└──────────────┘         └──────────────┘
```

- **기본**: HTTP REST API (`/api/*`) - Web UI와 동일한 엔드포인트
- **인증**: JWT 쿠키 → Bearer 토큰 적응 (모바일 친화적)
- **실시간 업데이트**: TanStack Query 폴링 (Web UI와 동일 간격: 활성 5초, 유휴 15-30초)
- **푸시 알림**: 태스크 완료, 순회 이벤트, 오류 알림용 FCM (Phase 2)

---

## 3. 주요 기능

### 3.1 기능 매트릭스

| 기능 | Web UI 대응 | 모바일 동작 |
|------|------------|-----------|
| **대시보드** | Dashboard.tsx | 프로젝트 요약 카드, 순회 상태, 빠른 통계 |
| **프로젝트** | Projects.tsx | 검색, 정렬, 핀, 카테고리 필터가 있는 목록 |
| **프로젝트 편집** | ProjectEdit.tsx | 설명, 병렬 수, 카테고리, 삭제 편집 |
| **태스크** | Tasks.tsx | 트리/리스트 뷰, 상태 필터, 상세 드로어 |
| **메시지** | Messages.tsx | 채팅 버블 UI, 메시지 전송 |
| **스펙** | Specs.tsx | 이중 패널 목록 + 상세, 상태 라이프사이클 |
| **스케줄** | Schedules.tsx | 스케줄 목록, 활성/비활성 토글, 실행 이력 |
| **설정** | Settings.tsx | 서버 연결, 알림 설정 |
| **로그인/설정** | Login.tsx, Setup.tsx | 비밀번호 + TOTP, QR 코드 설정 |

### 3.2 프로젝트 관리

- 검색, 정렬(최근 접근 / 생성일 / 태스크 수), 카테고리 필터로 전체 프로젝트 조회
- 빠른 접근을 위한 프로젝트 핀/핀 해제
- 활성 프로젝트 전환
- 프로젝트 상세 조회 및 설정 편집 (설명, 병렬 워커, 카테고리)
- 프로젝트 태스크 통계 개요

### 3.3 태스크 관리

- **트리 뷰**: 접기/펼치기 가능한 계층적 태스크 표시 (터치 최적화 들여쓰기)
- **리스트 뷰**: 상태 필터가 있는 플랫 목록 (todo, planned, split, done, failed)
- **태스크 상세**: Spec, Plan, Report를 마크다운으로 렌더링하는 전체 화면 뷰
- **액션**: 태스크 생성, 제목/스펙/상태/우선순위 편집, 삭제
- **일괄 작업**: Plan All, Run All, Cycle, Stop - 확인 다이얼로그 포함
- **상태 바**: 시각적 태스크 상태 분포 (Web UI 상단 바와 동일)

### 3.4 메시지 & 채팅

- 채팅 버블 인터페이스 (사용자 메시지 오른쪽, 봇 응답 왼쪽)
- 활성 프로젝트에 대해 Claude Code에 메시지 전송
- 메시지 상태 확인 (pending → processing → done/failed)
- 전체 결과/리포트가 포함된 메시지 상세 뷰
- 프로젝트별 메시지 필터링

### 3.5 스펙 관리

- 상태 배지가 있는 스펙 목록 (draft, review, approved, deprecated)
- 제목과 마크다운 내용으로 스펙 생성/편집
- 상태 라이프사이클 관리
- 우선순위 정렬

### 3.6 스케줄 관리

- cron 표현식이 표시되는 스케줄 목록
- 활성/비활성 토글 스위치
- 각 스케줄의 실행 이력(runs) 조회
- 스케줄 타입 표시 (Claude / Bash)
- 프로젝트별 스케줄 필터링

### 3.7 푸시 알림 (Phase 2)

| 이벤트 | 알림 내용 |
|--------|----------|
| 태스크 완료 | "Task #42 'Fix login bug' 완료" |
| 태스크 실패 | "Task #43 'Add auth' 실패: timeout" |
| 순회 완료 | "순회 완료: 12/12 태스크 완료" |
| 순회 중단 | "순회 중단 (task #44) - 인증 오류" |
| 메시지 처리 완료 | "'api-server' 프로젝트 메시지에 대한 응답 준비됨" |
| 스케줄 실행 실패 | "스케줄 'daily-backup' 실패" |

### 3.8 인증

- **설정 플로우**: 3단계 위저드 (비밀번호 → QR 코드 → TOTP 확인) - Web UI와 동일
- **로그인**: 비밀번호 + 6자리 TOTP 코드
- **토큰 저장**: 시스템 키체인에 JWT 보안 저장 (AsyncStorage가 아님)
- **세션**: 자동 갱신, 만료 시 로그아웃

---

## 4. 화면 설계

### 4.1 네비게이션 구조

```
┌─────────────────────────────────────┐
│  하단 탭 네비게이션                    │
├─────────┬─────────┬─────────┬───────┤
│대시보드  │  태스크  │ 메시지  │  더보기│
│   🏠    │   ✅    │   💬    │  ···  │
└─────────┴─────────┴─────────┴───────┘
                                  │
                          ┌───────┴───────┐
                          │  더보기 메뉴   │
                          ├───────────────┤
                          │  프로젝트     │
                          │  스펙         │
                          │  스케줄       │
                          │  설정         │
                          └───────────────┘
```

- **하단 탭**: 4개 주요 탭 (대시보드, 태스크, 메시지, 더보기)
- **헤더**: 프로젝트 선택 드롭다운 + Claude 상태 배지
- **스택 네비게이션**: 각 탭은 하위 탐색을 위한 자체 네비게이션 스택 보유

### 4.2 대시보드 화면

```
┌─────────────────────────────────┐
│  [프로젝트 ▼]       🟢 Claude  │  ← 헤더
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────────┐│
│  │  순회 상태                   ││
│  │  ████████░░ 8/10 실행 중     ││
│  │  단계: Running  ⏱ 12분      ││
│  └─────────────────────────────┘│
│                                 │
│  ┌─────────┐ ┌─────────┐       │
│  │  todo   │ │ planned │       │
│  │   12    │ │    5    │       │
│  └─────────┘ └─────────┘       │
│  ┌─────────┐ ┌─────────┐       │
│  │  done   │ │ failed  │       │
│  │   42    │ │    1    │       │
│  └─────────┘ └─────────┘       │
│                                 │
│  최근 메시지                     │
│  ┌─────────────────────────────┐│
│  │ 💬 로그인 버그 수정    2분 전 ││
│  │ 💬 로깅 추가         15분 전 ││
│  └─────────────────────────────┘│
│                                 │
│  프로젝트 통계                   │
│  ┌─────────────────────────────┐│
│  │ api-server   ██░░ 8/10     ││
│  │ blog         ████ 20/20    ││
│  │ docs         █░░░ 3/12     ││
│  └─────────────────────────────┘│
│                                 │
├─────────┬─────────┬─────────┬───┤
│대시보드  │ 태스크  │ 메시지  │···│
└─────────┴─────────┴─────────┴───┘
```

### 4.3 태스크 화면

```
┌─────────────────────────────────┐
│  [프로젝트 ▼]       🟢 Claude  │
├─────────────────────────────────┤
│  상태: ⬜12 🔵5 🟢42 🔴1       │  ← 상태 바
├─────────────────────────────────┤
│  [🌳 트리] [📋 목록]  [필터 ▼]  │  ← 뷰 전환 + 필터
├─────────────────────────────────┤
│                                 │
│  ▼ #1 인증 시스템 구축    [done] │
│    ▶ #2 스키마 설계      [done] │
│    ▶ #3 API 구현         [done] │
│    ▼ #4 테스트 추가      [todo] │
│      #5 유닛 테스트      [todo] │
│      #6 E2E 테스트       [todo] │
│  ▶ #7 로깅 추가        [planned]│
│  #8 CSS 버그 수정        [todo] │
│                                 │
│                    [+ 새 태스크] │  ← FAB 버튼
├─────────────────────────────────┤
│  [▶ Plan All] [▶▶ Run All]     │
│  [🔄 Cycle]   [⏹ Stop]         │
├─────────┬─────────┬─────────┬───┤
│대시보드  │ 태스크  │ 메시지  │···│
└─────────┴─────────┴─────────┴───┘

        ↓ 태스크 #4 탭

┌─────────────────────────────────┐
│  ← 뒤로          Task #4       │
├─────────────────────────────────┤
│  테스트 추가                     │
│  상태: todo    우선순위: 3       │
│  상위: #1 인증 시스템 구축       │
│  생성일: 2025-01-15 14:30       │
├─────────────────────────────────┤
│  [Spec] [Plan] [Report]        │  ← 탭 바
├─────────────────────────────────┤
│                                 │
│  ## Spec                        │
│                                 │
│  인증 시스템에 대한 유닛 테스트   │
│  및 E2E 테스트 작성:             │
│  - 로그인 엔드포인트             │
│  - 토큰 갱신                    │
│  - 권한 미들웨어                 │
│                                 │
│                                 │
│  [✏️ 편집] [▶ Plan] [▶▶ Run]   │
└─────────────────────────────────┘
```

### 4.4 메시지 / 채팅 화면

```
┌─────────────────────────────────┐
│  [프로젝트 ▼]       🟢 Claude  │
├─────────────────────────────────┤
│                                 │
│        2025년 1월 15일           │
│                                 │
│        ┌───────────────────┐    │
│        │ auth.go의 로그인   │    │
│        │ 버그 수정해줘      │    │
│        │         14:30  ✓  │    │
│        └───────────────────┘    │
│                                 │
│  ┌───────────────────┐          │
│  │ 완료. ValidateToken│          │
│  │ ()의 널 포인터를    │          │
│  │ 수정했습니다.       │          │
│  │                    │          │
│  │ [리포트 보기 ▶]     │          │
│  │ 14:32  ✅ 완료     │          │
│  └───────────────────┘          │
│                                 │
│        ┌───────────────────┐    │
│        │ API에 Rate        │    │
│        │ Limiting 추가해줘  │    │
│        │         15:01  ⏳ │    │
│        └───────────────────┘    │
│                                 │
├─────────────────────────────────┤
│  [메시지를 입력하세요...   ] [➤] │
├─────────┬─────────┬─────────┬───┤
│대시보드  │ 태스크  │ 메시지  │···│
└─────────┴─────────┴─────────┴───┘
```

### 4.5 설정 화면

```
┌─────────────────────────────────┐
│  설정                            │
├─────────────────────────────────┤
│                                 │
│  서버 연결                       │
│  ┌─────────────────────────────┐│
│  │ 서버 URL                    ││
│  │ [http://192.168.1.10:9847 ] ││
│  │                             ││
│  │ 상태: 🟢 연결됨              ││
│  │ 버전: v0.2.21              ││
│  │ 업타임: 3일 12시간           ││
│  └─────────────────────────────┘│
│                                 │
│  알림                            │
│  ┌─────────────────────────────┐│
│  │ 푸시 알림             [🔵] ││
│  │ 태스크 완료           [🔵] ││
│  │ 순회 이벤트           [🔵] ││
│  │ 오류 알림             [🔵] ││
│  └─────────────────────────────┘│
│                                 │
│  캐시                            │
│  ┌─────────────────────────────┐│
│  │ 캐시 데이터: 2.4 MB         ││
│  │ [캐시 삭제]                 ││
│  └─────────────────────────────┘│
│                                 │
│  계정                            │
│  ┌─────────────────────────────┐│
│  │ [로그아웃]                  ││
│  └─────────────────────────────┘│
│                                 │
├─────────┬─────────┬─────────┬───┤
│대시보드  │ 태스크  │ 메시지  │···│
└─────────┴─────────┴─────────┴───┘
```

---

## 5. 아키텍처

### 5.1 앱 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                     모바일 앱                            │
│                                                         │
│  ┌──────────┐  ┌──────────────┐  ┌──────────────────┐  │
│  │   화면   │  │  네비게이션   │  │      알림        │  │
│  │ (React   │  │  (React      │  │   (FCM + Local)  │  │
│  │  Native) │  │  Navigation) │  │                  │  │
│  └────┬─────┘  └──────────────┘  └──────────────────┘  │
│       │                                                  │
│  ┌────▼──────────────────────────────────────────────┐  │
│  │              TanStack Query 레이어                 │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────┐    │  │
│  │  │ Queries  │  │Mutations │  │ Invalidation │    │  │
│  │  │ (캐시)   │  │(낙관적   │  │ (변이 시)     │    │  │
│  │  └──────────┘  │ 업데이트)│  └──────────────┘    │  │
│  │                └──────────┘                       │  │
│  └────┬──────────────────────────────────────────────┘  │
│       │                                                  │
│  ┌────▼──────────────────────────────────────────────┐  │
│  │              API 클라이언트 레이어                  │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────┐    │  │
│  │  │ HTTP     │  │  인증    │  │   오프라인    │    │  │
│  │  │ Client   │  │  (JWT)   │  │   큐          │    │  │
│  │  └──────────┘  └──────────┘  └──────────────┘    │  │
│  └────┬──────────────────────────────────────────────┘  │
│       │                                                  │
│  ┌────▼──────────────────────────────────────────────┐  │
│  │              저장소 레이어                          │  │
│  │  ┌──────────┐  ┌──────────────┐                   │  │
│  │  │ MMKV     │  │   Keychain   │                   │  │
│  │  │ (캐시)   │  │  (JWT 토큰)  │                   │  │
│  │  └──────────┘  └──────────────┘                   │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                        │
                   HTTP / JSON
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                  Claribot 서버                           │
│                  (127.0.0.1:9847)                        │
│                                                          │
│   /api/auth/*    /api/projects/*    /api/tasks/*         │
│   /api/messages/*  /api/schedules/*  /api/specs/*        │
│   /api/configs/*   /api/status       /api/usage          │
└─────────────────────────────────────────────────────────┘
```

### 5.2 API 재사용 전략

모바일 앱은 기존 RESTful API 엔드포인트를 백엔드 수정 없이 재사용한다.

**Web UI에서 공유 가능한 코드** (공유 패키지 또는 복사):

| Web UI 모듈 | 모바일 대응 | 재사용 수준 |
|-------------|-----------|-----------|
| `types/index.ts` | `types/index.ts` | 100% - 동일한 TypeScript 타입 |
| `api/client.ts` | `api/client.ts` | 90% - `fetch`를 RN fetch로 교체, URL 설정 |
| `hooks/useClaribot.ts` | `hooks/useClaribot.ts` | 95% - 동일한 쿼리/뮤테이션 로직 |
| `hooks/useAuth.ts` | `hooks/useAuth.ts` | 80% - 토큰 저장을 키체인으로 적응 |
| 컴포넌트 로직 | 화면 로직 | 60% - JSX를 RN 컴포넌트로 적응 |

**API 엔드포인트 매핑** (전체 커버리지):

```
Auth:       POST /api/auth/setup, /login, /logout, GET /status, /totp-setup
Status:     GET  /api/status, /health, /usage
Projects:   GET/POST /api/projects, GET/PATCH/DELETE /api/projects/{id}
Tasks:      GET/POST /api/tasks, GET/PATCH/DELETE /api/tasks/{id}
            POST /api/tasks/{id}/plan, /run, /plan-all, /run-all, /cycle, /stop
Messages:   GET/POST /api/messages, GET /api/messages/{id}, /status, /processing
Schedules:  GET/POST /api/schedules, GET/PATCH/DELETE /api/schedules/{id}
            POST /api/schedules/{id}/enable, /disable, GET /runs
Specs:      GET/POST /api/specs, GET/PATCH/DELETE /api/specs/{id}
Configs:    GET/PUT/DELETE /api/configs/{key}, GET/PUT /api/config-yaml
```

### 5.3 인증 적응

Web UI는 HTTP-only JWT 쿠키를 사용한다. 모바일 앱에서는:

- **옵션 A (권장)**: 기존 인증 미들웨어에 `Authorization: Bearer <token>` 헤더 지원 추가. 서버가 로그인 시 응답 본문에 JWT를 반환하고, 모바일 앱이 시스템 키체인에 저장.
- **옵션 B**: React Native의 쿠키 jar를 사용하여 쿠키 방식 유지.

옵션 A가 선호되는 이유:
1. 보안 키체인 저장이 모바일에 더 적합
2. 쿠키 관리 복잡성 없음
3. 백그라운드 fetch/알림과 더 잘 동작
4. 최소한의 서버 변경 (미들웨어에서 쿠키 OR Authorization 헤더 확인)

### 5.4 네트워크 & 오프라인 전략

| 시나리오 | 동작 |
|---------|------|
| **로컬 네트워크** | `192.168.x.x:9847`로 직접 HTTP (같은 LAN) |
| **외부 접근** | VPN 또는 HTTPS가 필요한 리버스 프록시 |
| **오프라인 - 읽기** | TanStack Query 캐시가 시각적 표시와 함께 만료 데이터 제공 |
| **오프라인 - 쓰기** | 뮤테이션을 로컬에 큐잉, 재연결 시 동기화 |
| **재연결** | 모든 쿼리 자동 무효화, 뮤테이션 큐 재실행 |

---

## 6. 구현 로드맵

### Phase 1: 핵심 MVP

**목표**: 기본 읽기 + 전송 기능, 텔레그램 봇의 핵심 기능에 해당.

| 기능 | 세부사항 |
|------|---------|
| 인증 | 로그인 (비밀번호 + TOTP), 설정 위저드 |
| 대시보드 | 프로젝트 통계, Claude 상태, 순회 상태 |
| 프로젝트 | 목록, 전환, 검색, 필터 |
| 태스크 | 트리/리스트 뷰, 상태 필터, 태스크 상세 (읽기 전용) |
| 메시지 | 채팅 UI, 메시지 전송, 응답 확인 |
| 설정 | 서버 URL 설정, 로그아웃 |

**예상 범위**: 6개 화면, API 클라이언트, 인증 플로우, 기본 네비게이션

### Phase 2: 전체 CRUD + 알림

**목표**: Web UI와 기능 동등성 + 모바일 전용 푸시 알림.

| 기능 | 세부사항 |
|------|---------|
| 태스크 CRUD | 태스크 생성, 편집, 삭제 |
| 태스크 액션 | Plan, Run, Plan All, Run All, Cycle, Stop |
| 스펙 CRUD | 스펙 생성, 편집, 삭제 및 상태 관리 |
| 스케줄 | 전체 CRUD, 활성/비활성, 실행 이력 |
| 프로젝트 편집 | 설명, 병렬 수, 카테고리, 삭제 편집 |
| 푸시 알림 | 태스크/순회/메시지 이벤트에 대한 FCM 통합 |
| 서버 Push Agent | 이벤트 발생 시 FCM 메시지를 보내는 백엔드 컴포넌트 |

### Phase 3: 고급 기능

**목표**: Web UI 기능 동등성을 넘어선 모바일 최적화 기능.

| 기능 | 세부사항 |
|------|---------|
| 오프라인 캐시 | MMKV 기반 영구 캐시, 오프라인 읽기 접근 |
| 뮤테이션 큐 | 오프라인 시 쓰기 큐잉, 재연결 시 동기화 |
| 홈 화면 위젯 | 빠른 태스크 통계 / 순회 상태 위젯 (iOS/Android) |
| 빠른 액션 | 3D Touch / 롱프레스 바로가기 (새 태스크, 메시지 전송) |
| 생체 인증 | Face ID / 지문 잠금 해제 (저장된 JWT + 생체 인증 게이트) |
| 다크 모드 | 시스템 테마 연동 |
| 햅틱 피드백 | 태스크 완료, 순회 이벤트에 대한 촉각 응답 |

---

## 7. 프로젝트 구조

```
claribot-mobile/
├── src/
│   ├── api/
│   │   └── client.ts           # API 클라이언트 (gui/src/api/client.ts 기반)
│   ├── screens/
│   │   ├── DashboardScreen.tsx
│   │   ├── TasksScreen.tsx
│   │   ├── TaskDetailScreen.tsx
│   │   ├── MessagesScreen.tsx
│   │   ├── ProjectsScreen.tsx
│   │   ├── ProjectEditScreen.tsx
│   │   ├── SpecsScreen.tsx
│   │   ├── SchedulesScreen.tsx
│   │   ├── SettingsScreen.tsx
│   │   ├── LoginScreen.tsx
│   │   └── SetupScreen.tsx
│   ├── components/
│   │   ├── ChatBubble.tsx
│   │   ├── MarkdownRenderer.tsx
│   │   ├── ProjectSelector.tsx
│   │   ├── TaskTreeItem.tsx
│   │   ├── StatusBar.tsx
│   │   └── CycleProgress.tsx
│   ├── hooks/
│   │   ├── useClaribot.ts      # TanStack Query 훅 (Web UI와 공유)
│   │   └── useAuth.ts          # 인증 훅 (키체인 적응)
│   ├── navigation/
│   │   ├── TabNavigator.tsx
│   │   ├── StackNavigator.tsx
│   │   └── AuthNavigator.tsx
│   ├── types/
│   │   └── index.ts            # 공유 타입 (gui/src/types/index.ts와 동일)
│   ├── storage/
│   │   ├── cache.ts            # MMKV 캐시 래퍼
│   │   └── keychain.ts         # JWT 보안 저장
│   └── App.tsx
├── android/
├── ios/
├── package.json
└── tsconfig.json
```

---

## 8. 서버 측 필요 변경사항

최소한의 백엔드 수정 필요:

| 변경사항 | 파일 | 설명 |
|---------|------|------|
| Bearer 토큰 인증 | `bot/internal/handler/auth.go` | JWT 쿠키 외에 `Authorization: Bearer <token>` 헤더 수용 |
| 로그인 응답 본문 | `bot/internal/handler/auth.go` | 로그인 응답 JSON에 JWT 토큰 반환 (Set-Cookie만이 아닌) |
| 푸시 알림 에이전트 | `bot/internal/push/` (신규) | 태스크/순회 이벤트 시 FCM 메시지 전송 통합 (Phase 2) |
| FCM 토큰 등록 | `POST /api/auth/fcm-token` (신규) | 푸시 전달을 위한 기기 FCM 토큰 저장 (Phase 2) |

Phase 1에는 Bearer 토큰 인증 변경만 필요 (2개 파일 수정).

---

## 9. 디자인 가이드라인

### 9.1 터치 타겟

- 최소 터치 타겟: 44x44 포인트 (Apple HIG) / 48x48 dp (Material Design)
- Web UI의 기존 모바일 터치 타겟 작업과 일치 (태스크 #33-#36)

### 9.2 타이포그래피

- 시스템 폰트 사용 (iOS: San Francisco, Android: Roboto)
- 코드 블록, cron 표현식, 태스크 ID에 모노스페이스 폰트

### 9.3 색상 시스템

- Web UI의 색상 팔레트 일치 (shadcn/ui 기본값)
- 시스템 다크/라이트 모드 토글 지원
- 상태 색상: todo (회색), planned (파란색), split (보라색), done (초록색), failed (빨간색)

### 9.4 플랫폼 관례

- iOS: 큰 제목 네비게이션 바, 뒤로 스와이프 제스처, 하단 탭 바
- Android: Material Design 3, 네비게이션 드로어 옵션, 주요 액션용 FAB
- 공통: 모든 목록 화면에서 당겨서 새로고침
