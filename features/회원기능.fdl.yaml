feature: member_system
description: 로그인, 회원가입, 마이페이지, 프로필, 2FA 보안인증 기능

models:
  - name: User
    table: users
    fields:
      - id: uuid (pk)
      - email: string(255) (required, unique, index)
      - password_hash: string(255) (required)
      - username: string(100) (required, unique)
      - is_active: boolean (default: true)
      - is_verified: boolean (default: false)
      - two_factor_enabled: boolean (default: false)
      - two_factor_secret: string(255) (nullable)
      - created_at: datetime (default: now)
      - updated_at: datetime (default: now)
      - last_login_at: datetime (nullable)

  - name: UserProfile
    table: user_profiles
    fields:
      - id: uuid (pk)
      - user_id: uuid (fk: users.id, onDelete: cascade, unique)
      - display_name: string(100) (nullable)
      - bio: text (nullable)
      - avatar_url: string(500) (nullable)
      - phone: string(20) (nullable)
      - birth_date: date (nullable)
      - timezone: string(50) (default: "UTC")
      - language: string(10) (default: "ko")
      - created_at: datetime (default: now)
      - updated_at: datetime (default: now)

  - name: Session
    table: sessions
    fields:
      - id: uuid (pk)
      - user_id: uuid (fk: users.id, onDelete: cascade, index)
      - access_token: string(500) (required, unique)
      - refresh_token: string(500) (required, unique)
      - device_info: string(255) (nullable)
      - ip_address: string(45) (nullable)
      - expires_at: datetime (required)
      - refresh_expires_at: datetime (required)
      - created_at: datetime (default: now)

  - name: TwoFactorBackupCode
    table: two_factor_backup_codes
    fields:
      - id: uuid (pk)
      - user_id: uuid (fk: users.id, onDelete: cascade, index)
      - code_hash: string(255) (required)
      - is_used: boolean (default: false)
      - used_at: datetime (nullable)
      - created_at: datetime (default: now)

  - name: PasswordResetToken
    table: password_reset_tokens
    fields:
      - id: uuid (pk)
      - user_id: uuid (fk: users.id, onDelete: cascade, index)
      - token_hash: string(255) (required, unique)
      - expires_at: datetime (required)
      - is_used: boolean (default: false)
      - created_at: datetime (default: now)

  - name: LoginHistory
    table: login_history
    fields:
      - id: uuid (pk)
      - user_id: uuid (fk: users.id, onDelete: cascade, index)
      - login_at: datetime (default: now)
      - ip_address: string(45) (nullable)
      - device_info: string(255) (nullable)
      - success: boolean (required)
      - failure_reason: string(100) (nullable)

service:
  # 회원가입
  - name: register
    input: { email: string, password: string, username: string }
    steps:
      - validate: "이메일 형식, 비밀번호 강도(8자 이상, 대소문자+숫자), 사용자명 2-100자"
      - db: "SELECT * FROM users WHERE email = ? OR username = ?"
      - check: "이메일/사용자명 중복 시 에러 반환"
      - transform: "비밀번호 bcrypt 해시"
      - db: "INSERT INTO users (email, password_hash, username)"
      - db: "INSERT INTO user_profiles (user_id)"
      - event: "이메일 인증 메일 발송 (선택적)"
      - return: "User (비밀번호 제외)"

  # 로그인
  - name: login
    input: { email: string, password: string, deviceInfo: string }
    steps:
      - validate: "이메일, 비밀번호 필수"
      - db: "SELECT * FROM users WHERE email = ?"
      - check: "사용자 존재 여부, 계정 활성화 상태 확인"
      - verify: "bcrypt 비밀번호 검증"
      - check: "2FA 활성화 시 requiresTwoFactor: true 반환"
      - transform: "JWT access_token, refresh_token 생성"
      - db: "INSERT INTO sessions"
      - db: "UPDATE users SET last_login_at = NOW()"
      - db: "INSERT INTO login_history (success: true)"
      - return: "{ accessToken, refreshToken, expiresAt, user }"

  # 2FA 로그인 검증
  - name: verifyLoginTwoFactor
    input: { email: string, password: string, totpCode: string, deviceInfo: string }
    steps:
      - validate: "TOTP 코드 6자리 숫자"
      - db: "SELECT * FROM users WHERE email = ?"
      - verify: "비밀번호 재검증"
      - verify: "TOTP 코드 검증 (time-based)"
      - check: "실패 시 백업 코드로 시도 가능"
      - transform: "JWT 토큰 생성"
      - db: "INSERT INTO sessions"
      - db: "INSERT INTO login_history (success: true)"
      - return: "{ accessToken, refreshToken, expiresAt, user }"

  # 로그아웃
  - name: logout
    input: { sessionId: uuid }
    steps:
      - db: "DELETE FROM sessions WHERE id = ?"
      - return: "{ success: true }"

  # 모든 세션 로그아웃
  - name: logoutAll
    input: { userId: uuid }
    steps:
      - db: "DELETE FROM sessions WHERE user_id = ?"
      - return: "{ success: true, count: 삭제된 세션 수 }"

  # 토큰 갱신
  - name: refreshToken
    input: { refreshToken: string }
    steps:
      - db: "SELECT * FROM sessions WHERE refresh_token = ?"
      - check: "세션 존재 및 refresh_expires_at 만료 확인"
      - transform: "새 access_token 생성"
      - db: "UPDATE sessions SET access_token = ?, expires_at = ?"
      - return: "{ accessToken, expiresAt }"

  # 내 정보 조회
  - name: getMe
    input: { userId: uuid }
    steps:
      - db: "SELECT * FROM users WHERE id = ?"
      - db: "SELECT * FROM user_profiles WHERE user_id = ?"
      - return: "User + UserProfile (비밀번호 제외)"

  # 프로필 수정
  - name: updateProfile
    input: { userId: uuid, displayName: string, bio: string, avatarUrl: string, phone: string, birthDate: date, timezone: string, language: string }
    steps:
      - validate: "displayName 100자 이내, bio 1000자 이내"
      - db: "UPDATE user_profiles SET ... WHERE user_id = ?"
      - return: "업데이트된 UserProfile"

  # 비밀번호 변경
  - name: changePassword
    input: { userId: uuid, currentPassword: string, newPassword: string }
    steps:
      - validate: "새 비밀번호 강도 검증"
      - db: "SELECT password_hash FROM users WHERE id = ?"
      - verify: "현재 비밀번호 검증"
      - check: "현재 비밀번호와 새 비밀번호 다른지 확인"
      - transform: "새 비밀번호 bcrypt 해시"
      - db: "UPDATE users SET password_hash = ?, updated_at = NOW()"
      - db: "DELETE FROM sessions WHERE user_id = ? (선택: 다른 세션 무효화)"
      - return: "{ success: true }"

  # 비밀번호 재설정 요청
  - name: requestPasswordReset
    input: { email: string }
    steps:
      - db: "SELECT * FROM users WHERE email = ?"
      - check: "사용자 존재하지 않아도 성공 응답 (보안)"
      - transform: "랜덤 토큰 생성 및 해시"
      - db: "INSERT INTO password_reset_tokens"
      - event: "비밀번호 재설정 이메일 발송"
      - return: "{ success: true, message: '이메일 발송됨' }"

  # 비밀번호 재설정
  - name: resetPassword
    input: { token: string, newPassword: string }
    steps:
      - validate: "새 비밀번호 강도 검증"
      - db: "SELECT * FROM password_reset_tokens WHERE token_hash = ?"
      - check: "토큰 유효성, 만료 여부, 사용 여부 확인"
      - transform: "새 비밀번호 bcrypt 해시"
      - db: "UPDATE users SET password_hash = ?"
      - db: "UPDATE password_reset_tokens SET is_used = true, used_at = NOW()"
      - db: "DELETE FROM sessions WHERE user_id = ? (모든 세션 무효화)"
      - return: "{ success: true }"

  # 2FA 활성화 시작
  - name: enable2FA
    input: { userId: uuid }
    steps:
      - db: "SELECT two_factor_enabled FROM users WHERE id = ?"
      - check: "이미 활성화되어 있으면 에러"
      - transform: "TOTP secret 생성 (base32)"
      - db: "UPDATE users SET two_factor_secret = ? WHERE id = ?"
      - transform: "QR 코드 URI 생성 (otpauth://totp/...)"
      - return: "{ secret, qrCodeUri, backupCodes: [] }"

  # 2FA 활성화 확인
  - name: confirm2FA
    input: { userId: uuid, totpCode: string }
    steps:
      - validate: "TOTP 코드 6자리"
      - db: "SELECT two_factor_secret FROM users WHERE id = ?"
      - verify: "TOTP 코드 검증"
      - transform: "백업 코드 10개 생성"
      - db: "UPDATE users SET two_factor_enabled = true"
      - db: "INSERT INTO two_factor_backup_codes (10개)"
      - return: "{ success: true, backupCodes: [10개 코드] }"

  # 2FA 비활성화
  - name: disable2FA
    input: { userId: uuid, password: string, totpCode: string }
    steps:
      - db: "SELECT * FROM users WHERE id = ?"
      - verify: "비밀번호 검증"
      - verify: "TOTP 코드 또는 백업 코드 검증"
      - db: "UPDATE users SET two_factor_enabled = false, two_factor_secret = NULL"
      - db: "DELETE FROM two_factor_backup_codes WHERE user_id = ?"
      - return: "{ success: true }"

  # 백업 코드 재생성
  - name: regenerateBackupCodes
    input: { userId: uuid, password: string }
    steps:
      - db: "SELECT * FROM users WHERE id = ?"
      - verify: "비밀번호 검증"
      - check: "2FA 활성화 상태 확인"
      - db: "DELETE FROM two_factor_backup_codes WHERE user_id = ?"
      - transform: "새 백업 코드 10개 생성"
      - db: "INSERT INTO two_factor_backup_codes (10개)"
      - return: "{ backupCodes: [10개 코드] }"

  # 로그인 기록 조회
  - name: getLoginHistory
    input: { userId: uuid, limit: int, offset: int }
    steps:
      - db: "SELECT * FROM login_history WHERE user_id = ? ORDER BY login_at DESC LIMIT ? OFFSET ?"
      - return: "LoginHistory[]"

  # 활성 세션 목록
  - name: getActiveSessions
    input: { userId: uuid }
    steps:
      - db: "SELECT * FROM sessions WHERE user_id = ? AND expires_at > NOW()"
      - return: "Session[] (토큰 제외, 기기 정보만)"

  # 특정 세션 종료
  - name: revokeSession
    input: { userId: uuid, sessionId: uuid }
    steps:
      - db: "SELECT * FROM sessions WHERE id = ? AND user_id = ?"
      - check: "세션 소유권 확인"
      - db: "DELETE FROM sessions WHERE id = ?"
      - return: "{ success: true }"

  # 계정 삭제
  - name: deleteAccount
    input: { userId: uuid, password: string }
    steps:
      - db: "SELECT * FROM users WHERE id = ?"
      - verify: "비밀번호 검증"
      - db: "DELETE FROM users WHERE id = ? (CASCADE로 관련 데이터 삭제)"
      - return: "{ success: true }"

api:
  # 인증 관련
  - path: /auth/register
    method: POST
    summary: 회원가입
    use: service.register
    request:
      body: { email: string, password: string, username: string }
    response:
      201: { id: uuid, email: string, username: string, createdAt: datetime }
      400: { error: string, code: "VALIDATION_ERROR" }
      409: { error: string, code: "DUPLICATE_EMAIL" | "DUPLICATE_USERNAME" }

  - path: /auth/login
    method: POST
    summary: 로그인
    use: service.login
    request:
      body: { email: string, password: string, deviceInfo: string }
    response:
      200: { accessToken: string, refreshToken: string, expiresAt: datetime, user: object }
      200: { requiresTwoFactor: true }
      401: { error: string, code: "INVALID_CREDENTIALS" }
      403: { error: string, code: "ACCOUNT_DISABLED" }

  - path: /auth/login/2fa
    method: POST
    summary: 2FA 로그인 검증
    use: service.verifyLoginTwoFactor
    request:
      body: { email: string, password: string, totpCode: string, deviceInfo: string }
    response:
      200: { accessToken: string, refreshToken: string, expiresAt: datetime, user: object }
      401: { error: string, code: "INVALID_2FA_CODE" }

  - path: /auth/logout
    method: POST
    summary: 로그아웃
    use: service.logout
    auth: required
    request:
      headers: { Authorization: "Bearer {accessToken}" }
    response:
      200: { success: true }
      401: { error: string, code: "UNAUTHORIZED" }

  - path: /auth/logout/all
    method: POST
    summary: 모든 기기에서 로그아웃
    use: service.logoutAll
    auth: required
    response:
      200: { success: true, count: int }

  - path: /auth/refresh
    method: POST
    summary: 토큰 갱신
    use: service.refreshToken
    request:
      body: { refreshToken: string }
    response:
      200: { accessToken: string, expiresAt: datetime }
      401: { error: string, code: "INVALID_REFRESH_TOKEN" }

  - path: /auth/password/reset-request
    method: POST
    summary: 비밀번호 재설정 요청
    use: service.requestPasswordReset
    request:
      body: { email: string }
    response:
      200: { success: true, message: string }

  - path: /auth/password/reset
    method: POST
    summary: 비밀번호 재설정
    use: service.resetPassword
    request:
      body: { token: string, newPassword: string }
    response:
      200: { success: true }
      400: { error: string, code: "INVALID_TOKEN" | "TOKEN_EXPIRED" }

  # 사용자 정보
  - path: /users/me
    method: GET
    summary: 내 정보 조회
    use: service.getMe
    auth: required
    response:
      200: { id: uuid, email: string, username: string, isVerified: boolean, twoFactorEnabled: boolean, profile: object, createdAt: datetime }

  - path: /users/me/profile
    method: PUT
    summary: 프로필 수정
    use: service.updateProfile
    auth: required
    request:
      body: { displayName: string, bio: string, avatarUrl: string, phone: string, birthDate: date, timezone: string, language: string }
    response:
      200: { displayName: string, bio: string, avatarUrl: string, phone: string, birthDate: date, timezone: string, language: string, updatedAt: datetime }
      400: { error: string, code: "VALIDATION_ERROR" }

  - path: /users/me/password
    method: PUT
    summary: 비밀번호 변경
    use: service.changePassword
    auth: required
    request:
      body: { currentPassword: string, newPassword: string }
    response:
      200: { success: true }
      400: { error: string, code: "WEAK_PASSWORD" }
      401: { error: string, code: "INVALID_CURRENT_PASSWORD" }

  - path: /users/me
    method: DELETE
    summary: 계정 삭제
    use: service.deleteAccount
    auth: required
    request:
      body: { password: string }
    response:
      200: { success: true }
      401: { error: string, code: "INVALID_PASSWORD" }

  # 2FA 관련
  - path: /users/me/2fa
    method: POST
    summary: 2FA 활성화 시작
    use: service.enable2FA
    auth: required
    response:
      200: { secret: string, qrCodeUri: string }
      409: { error: string, code: "2FA_ALREADY_ENABLED" }

  - path: /users/me/2fa/confirm
    method: POST
    summary: 2FA 활성화 확인
    use: service.confirm2FA
    auth: required
    request:
      body: { totpCode: string }
    response:
      200: { success: true, backupCodes: [string] }
      400: { error: string, code: "INVALID_TOTP_CODE" }

  - path: /users/me/2fa
    method: DELETE
    summary: 2FA 비활성화
    use: service.disable2FA
    auth: required
    request:
      body: { password: string, totpCode: string }
    response:
      200: { success: true }
      401: { error: string, code: "INVALID_PASSWORD" | "INVALID_TOTP_CODE" }

  - path: /users/me/2fa/backup-codes
    method: POST
    summary: 백업 코드 재생성
    use: service.regenerateBackupCodes
    auth: required
    request:
      body: { password: string }
    response:
      200: { backupCodes: [string] }
      401: { error: string, code: "INVALID_PASSWORD" }

  # 세션 관리
  - path: /users/me/sessions
    method: GET
    summary: 활성 세션 목록
    use: service.getActiveSessions
    auth: required
    response:
      200: [{ id: uuid, deviceInfo: string, ipAddress: string, createdAt: datetime, expiresAt: datetime }]

  - path: /users/me/sessions/{sessionId}
    method: DELETE
    summary: 특정 세션 종료
    use: service.revokeSession
    auth: required
    response:
      200: { success: true }
      404: { error: string, code: "SESSION_NOT_FOUND" }

  # 로그인 기록
  - path: /users/me/login-history
    method: GET
    summary: 로그인 기록 조회
    use: service.getLoginHistory
    auth: required
    request:
      query: { limit: int, offset: int }
    response:
      200: [{ id: uuid, loginAt: datetime, ipAddress: string, deviceInfo: string, success: boolean, failureReason: string }]

ui:
  # 로그인 페이지
  - component: LoginPage
    type: Page
    route: /login
    state:
      - email: string
      - password: string
      - isLoading: boolean
      - error: string
      - requiresTwoFactor: boolean
      - totpCode: string
    view:
      - Card: "로그인"
        children:
          - Input: "이메일"
            bind: email
            type: email
            placeholder: "example@email.com"
          - Input: "비밀번호"
            bind: password
            type: password
          - Conditional: "requiresTwoFactor"
            show:
              - Input: "인증 코드"
                bind: totpCode
                placeholder: "6자리 숫자"
          - ErrorMessage: "에러 표시"
            bind: error
          - Button: "로그인"
            action: API.POST /auth/login
            onSuccess: "대시보드로 이동"
            onRequires2FA: "requiresTwoFactor = true"
          - Link: "비밀번호를 잊으셨나요?"
            to: /forgot-password
          - Link: "계정이 없으신가요? 회원가입"
            to: /register

  # 회원가입 페이지
  - component: RegisterPage
    type: Page
    route: /register
    state:
      - email: string
      - username: string
      - password: string
      - confirmPassword: string
      - isLoading: boolean
      - error: string
      - validationErrors: object
    view:
      - Card: "회원가입"
        children:
          - Input: "이메일"
            bind: email
            type: email
            validation: "이메일 형식"
          - Input: "사용자명"
            bind: username
            validation: "2-100자"
          - Input: "비밀번호"
            bind: password
            type: password
            validation: "8자 이상, 대소문자+숫자"
          - Input: "비밀번호 확인"
            bind: confirmPassword
            type: password
            validation: "password와 일치"
          - ErrorMessage: "에러 표시"
            bind: error
          - Button: "가입하기"
            action: API.POST /auth/register
            onSuccess: "로그인 페이지로 이동"
          - Link: "이미 계정이 있으신가요? 로그인"
            to: /login

  # 비밀번호 재설정 요청 페이지
  - component: ForgotPasswordPage
    type: Page
    route: /forgot-password
    state:
      - email: string
      - isSubmitted: boolean
      - isLoading: boolean
    view:
      - Card: "비밀번호 재설정"
        children:
          - Conditional: "!isSubmitted"
            show:
              - Text: "가입한 이메일 주소를 입력하세요"
              - Input: "이메일"
                bind: email
                type: email
              - Button: "재설정 링크 보내기"
                action: API.POST /auth/password/reset-request
                onSuccess: "isSubmitted = true"
          - Conditional: "isSubmitted"
            show:
              - SuccessMessage: "이메일이 발송되었습니다"
              - Text: "메일함을 확인해주세요"
          - Link: "로그인으로 돌아가기"
            to: /login

  # 비밀번호 재설정 페이지
  - component: ResetPasswordPage
    type: Page
    route: /reset-password
    props: { token: string }
    state:
      - newPassword: string
      - confirmPassword: string
      - isLoading: boolean
      - error: string
    view:
      - Card: "새 비밀번호 설정"
        children:
          - Input: "새 비밀번호"
            bind: newPassword
            type: password
          - Input: "비밀번호 확인"
            bind: confirmPassword
            type: password
          - ErrorMessage: "에러 표시"
            bind: error
          - Button: "비밀번호 변경"
            action: API.POST /auth/password/reset
            onSuccess: "로그인 페이지로 이동"

  # 마이페이지
  - component: MyPage
    type: Page
    route: /mypage
    auth: required
    state:
      - user: object
      - isLoading: boolean
    init:
      - call: API.GET /users/me -> user
    view:
      - PageHeader: "마이페이지"
      - Grid:
        children:
          - ProfileSection: "프로필"
            props: { user: user }
          - SecuritySection: "보안 설정"
            props: { user: user }
          - SessionSection: "로그인 기기 관리"
          - DangerZone: "계정 삭제"

  # 프로필 섹션
  - component: ProfileSection
    type: Organism
    parent: MyPage
    props: { user: object }
    state:
      - isEditing: boolean
      - displayName: string
      - bio: string
      - avatarUrl: string
      - phone: string
      - birthDate: date
      - timezone: string
      - language: string
    init:
      - set: "user.profile 데이터로 state 초기화"
    view:
      - SectionCard: "프로필 정보"
        children:
          - Avatar: "프로필 사진"
            bind: avatarUrl
            editable: isEditing
          - Conditional: "!isEditing"
            show:
              - DisplayField: "표시 이름"
                value: displayName
              - DisplayField: "자기소개"
                value: bio
              - DisplayField: "연락처"
                value: phone
              - DisplayField: "생년월일"
                value: birthDate
              - Button: "수정"
                action: "isEditing = true"
          - Conditional: "isEditing"
            show:
              - Input: "표시 이름"
                bind: displayName
              - Textarea: "자기소개"
                bind: bio
                maxLength: 1000
              - Input: "연락처"
                bind: phone
                type: tel
              - DatePicker: "생년월일"
                bind: birthDate
              - Select: "시간대"
                bind: timezone
                options: "timezone 목록"
              - Select: "언어"
                bind: language
                options: [{ value: "ko", label: "한국어" }, { value: "en", label: "English" }]
              - ButtonGroup:
                children:
                  - Button: "저장"
                    action: API.PUT /users/me/profile
                    onSuccess: "isEditing = false"
                  - Button: "취소"
                    variant: secondary
                    action: "isEditing = false, state 복원"

  # 보안 설정 섹션
  - component: SecuritySection
    type: Organism
    parent: MyPage
    props: { user: object }
    state:
      - showPasswordForm: boolean
      - show2FASetup: boolean
      - currentPassword: string
      - newPassword: string
      - confirmPassword: string
    view:
      - SectionCard: "보안"
        children:
          - SecurityItem: "비밀번호"
            description: "마지막 변경: user.passwordChangedAt"
            action:
              - Button: "변경"
                onClick: "showPasswordForm = true"
          - SecurityItem: "2단계 인증"
            description: "user.twoFactorEnabled ? '활성화됨' : '비활성화됨'"
            status: user.twoFactorEnabled
            action:
              - Conditional: "!user.twoFactorEnabled"
                show:
                  - Button: "설정"
                    onClick: "show2FASetup = true"
              - Conditional: "user.twoFactorEnabled"
                show:
                  - Button: "비활성화"
                    variant: danger
                    action: "2FA 비활성화 모달 열기"

  # 비밀번호 변경 폼
  - component: PasswordChangeForm
    type: Molecule
    parent: SecuritySection
    state:
      - currentPassword: string
      - newPassword: string
      - confirmPassword: string
      - error: string
      - isLoading: boolean
    view:
      - Modal: "비밀번호 변경"
        children:
          - Input: "현재 비밀번호"
            bind: currentPassword
            type: password
          - Input: "새 비밀번호"
            bind: newPassword
            type: password
          - PasswordStrength: "비밀번호 강도"
            value: newPassword
          - Input: "새 비밀번호 확인"
            bind: confirmPassword
            type: password
          - ErrorMessage: "에러 표시"
            bind: error
          - ButtonGroup:
            children:
              - Button: "변경"
                action: API.PUT /users/me/password
                onSuccess: "모달 닫기, 성공 메시지"
              - Button: "취소"
                variant: secondary
                action: "모달 닫기"

  # 2FA 설정 컴포넌트
  - component: TwoFactorSetup
    type: Organism
    parent: SecuritySection
    state:
      - step: enum(qr, verify, complete)
      - secret: string
      - qrCodeUri: string
      - totpCode: string
      - backupCodes: [string]
      - error: string
    init:
      - call: API.POST /users/me/2fa -> { secret, qrCodeUri }
      - set: "step = 'qr'"
    view:
      - Modal: "2단계 인증 설정"
        children:
          - Stepper: "단계 표시"
            steps: ["QR 코드 스캔", "코드 확인", "완료"]
            current: step
          - Conditional: "step == 'qr'"
            show:
              - QRCode: "인증 앱 QR 코드"
                value: qrCodeUri
              - Text: "Google Authenticator 또는 Authy 앱으로 스캔하세요"
              - CopyField: "수동 입력 코드"
                value: secret
              - Button: "다음"
                action: "step = 'verify'"
          - Conditional: "step == 'verify'"
            show:
              - Text: "앱에 표시된 6자리 코드를 입력하세요"
              - OTPInput: "인증 코드"
                bind: totpCode
                length: 6
              - ErrorMessage: "에러"
                bind: error
              - Button: "확인"
                action: API.POST /users/me/2fa/confirm
                onSuccess: "step = 'complete', backupCodes 저장"
          - Conditional: "step == 'complete'"
            show:
              - SuccessIcon: "설정 완료"
              - Text: "2단계 인증이 활성화되었습니다"
              - Alert: "백업 코드 안내"
                type: warning
                message: "아래 백업 코드를 안전한 곳에 보관하세요. 인증 앱을 사용할 수 없을 때 필요합니다."
              - BackupCodeList: "백업 코드"
                codes: backupCodes
                copyable: true
              - Button: "완료"
                action: "모달 닫기, user.twoFactorEnabled = true"

  # 세션 관리 섹션
  - component: SessionSection
    type: Organism
    parent: MyPage
    state:
      - sessions: [object]
      - currentSessionId: uuid
      - isLoading: boolean
    init:
      - call: API.GET /users/me/sessions -> sessions
    view:
      - SectionCard: "로그인 된 기기"
        children:
          - List: "세션 목록"
            items: sessions
            renderItem:
              - SessionItem: "세션 정보"
                props: { session: item }
                children:
                  - DeviceIcon: "기기 아이콘"
                    type: session.deviceInfo
                  - Text: "기기 정보"
                    value: session.deviceInfo
                  - Text: "IP 주소"
                    value: session.ipAddress
                  - Text: "로그인 일시"
                    value: session.createdAt
                  - Badge: "현재 기기"
                    show: session.id == currentSessionId
                  - Button: "로그아웃"
                    show: session.id != currentSessionId
                    variant: danger
                    size: small
                    action: API.DELETE /users/me/sessions/{session.id}
                    onSuccess: "sessions에서 제거"
          - Divider: ""
          - Button: "모든 기기에서 로그아웃"
            variant: danger
            action: API.POST /auth/logout/all
            confirm: "정말 모든 기기에서 로그아웃 하시겠습니까?"
            onSuccess: "로그인 페이지로 이동"

  # 로그인 기록 섹션
  - component: LoginHistorySection
    type: Organism
    parent: MyPage
    state:
      - history: [object]
      - isLoading: boolean
      - page: int
    init:
      - call: API.GET /users/me/login-history?limit=10&offset=0 -> history
    view:
      - SectionCard: "로그인 기록"
        children:
          - Table: "기록 테이블"
            columns: ["일시", "IP 주소", "기기", "상태"]
            data: history
            rowRender:
              - Cell: "일시"
                value: item.loginAt
                format: datetime
              - Cell: "IP 주소"
                value: item.ipAddress
              - Cell: "기기"
                value: item.deviceInfo
              - Cell: "상태"
                value: item.success ? "성공" : item.failureReason
                variant: item.success ? "success" : "danger"
          - Pagination: "페이지네이션"
            page: page
            onPageChange: API.GET /users/me/login-history?limit=10&offset={page*10}

  # 계정 삭제 섹션
  - component: DangerZone
    type: Organism
    parent: MyPage
    state:
      - showDeleteModal: boolean
      - password: string
      - confirmText: string
      - error: string
    view:
      - SectionCard: "위험 구역"
        variant: danger
        children:
          - Text: "계정을 삭제하면 모든 데이터가 영구적으로 삭제됩니다."
          - Button: "계정 삭제"
            variant: danger
            action: "showDeleteModal = true"
          - Modal: "계정 삭제 확인"
            show: showDeleteModal
            children:
              - Alert: "경고"
                type: danger
                message: "이 작업은 되돌릴 수 없습니다. 모든 데이터가 영구 삭제됩니다."
              - Input: "비밀번호 확인"
                bind: password
                type: password
              - Input: "확인을 위해 '계정삭제'를 입력하세요"
                bind: confirmText
                placeholder: "계정삭제"
              - ErrorMessage: "에러"
                bind: error
              - ButtonGroup:
                children:
                  - Button: "삭제"
                    variant: danger
                    disabled: confirmText != "계정삭제"
                    action: API.DELETE /users/me
                    onSuccess: "로그인 페이지로 이동"
                  - Button: "취소"
                    action: "showDeleteModal = false"
